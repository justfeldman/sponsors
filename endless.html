<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    // Game variables
    const players = [
      { x: 100, y: 350, width: 30, height: 30, color: "red", health: 100, keys: { left: "a", right: "d", up: "w", attack: " " } },
      { x: 700, y: 350, width: 30, height: 30, color: "blue", health: 100, keys: { left: "ArrowLeft", right: "ArrowRight", up: "ArrowUp", attack: "Enter" } },
    ];
    const attacks = []; // Store active attacks

    // Keyboard controls
    const keys = {};
    window.addEventListener("keydown", (e) => keys[e.key] = true);
    window.addEventListener("keyup", (e) => keys[e.key] = false);

    // Handle attacks
    function attack(playerIndex) {
      const player = players[playerIndex];
      attacks.push({
        x: player.x + (playerIndex === 0 ? player.width : -10), // Attack direction
        y: player.y + 10,
        width: 10,
        height: 10,
        color: player.color,
        playerIndex, // Track which player initiated the attack
      });
    }

    // Check collisions
    function checkCollisions() {
      for (let i = attacks.length - 1; i >= 0; i--) {
        const attack = attacks[i];

        // Check if the attack hits an opposing player
        players.forEach((player, index) => {
          if (index !== attack.playerIndex) {
            if (
              attack.x < player.x + player.width &&
              attack.x + attack.width > player.x &&
              attack.y < player.y + player.height &&
              attack.y + attack.height > player.y
            ) {
              // Reduce health
              player.health -= 10;
              attacks.splice(i, 1); // Remove the attack
              if (player.health <= 0) {
                alert(`Player ${attack.playerIndex + 1} Wins!`);
                resetGame();
              }
            }
          }
        });

        // Remove off-screen attacks
        if (attack.x < 0 || attack.x > canvas.width) {
          attacks.splice(i, 1);
        }
      }
    }

    // Reset the game
    function resetGame() {
      players[0].x = 100;
      players[0].health = 100;
      players[1].x = 700;
      players[1].health = 100;
      attacks.length = 0;
    }

    // Update game state
    function update() {
      players.forEach((player, index) => {
        // Movement
        if (keys[player.keys.left]) player.x -= 3;
        if (keys[player.keys.right]) player.x += 3;
        if (keys[player.keys.up] && player.y === 350) player.y -= 10; // Jump logic

        // Gravity
        if (player.y < 350) player.y += 5;

        // Attack
        if (keys[player.keys.attack]) {
          attack(index);
          keys[player.keys.attack] = false; // Prevent holding attack
        }

        // Keep player within bounds
        player.x = Math.max(0, Math.min(canvas.width - player.width, player.x));
      });

      // Update attacks
      attacks.forEach((attack) => {
        attack.x += attack.playerIndex === 0 ? 5 : -5; // Move attacks
      });

      checkCollisions(); // Check for attack collisions
    }

    // Draw game objects
    function draw() {
      // Clear canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Draw players
      players.forEach((player) => {
        ctx.fillStyle = player.color;
        ctx.fillRect(player.x, player.y, player.width, player.height);

        // Draw health bar
        ctx.fillStyle = "green";
        ctx.fillRect(player.x, player.y - 10, (player.health / 100) * player.width, 5);
      });

      // Draw attacks
      attacks.forEach((attack) => {
        ctx.fillStyle = attack.color;
        ctx.fillRect(attack.x, attack.y, attack.width, attack.height);
      });
    }

    // Game loop
    function gameLoop() {
      update();
      draw();
      requestAnimationFrame(gameLoop);
    }

    gameLoop();
</script>
